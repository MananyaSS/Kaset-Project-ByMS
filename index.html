<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏©‡∏ï‡∏£</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f0f4f8;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        .container {
            width: 100%;
            max-width: 800px;
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #2c5282;
            border-bottom: 2px solid #2c5282;
            padding-bottom: 10px;
        }
        .form-section {
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .form-group {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 15px;
        }
        .form-group label {
            flex: 1 1 200px;
            font-weight: bold;
            margin-right: 15px;
        }
        .form-group input, .form-group select {
            flex: 2 1 300px;
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 16px;
        }
        .hidden {
            display: none;
        }
        #total-cost, #net-profit {
            font-size: 24px;
            font-weight: bold;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-top: 10px;
        }
        #total-cost {
            background-color: #fed7d7;
            color: #c53030;
        }
        #net-profit.profit {
            background-color: #c6f6d5;
            color: #2f855a;
        }
        #net-profit.loss {
            background-color: #fed7d7;
            color: #c53030;
        }
        .export-buttons {
            text-align: center;
            margin-top: 30px;
        }
        .export-buttons button {
            background-color: #2c5282;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 10px;
            transition: background-color 0.3s;
        }
        .export-buttons button:hover {
            background-color: #1a365d;
        }
        .summary-section {
            margin-top: 30px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #edf2f7;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üìù ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏©‡∏ï‡∏£</h1>

    <div id="calculator-form">
        <div class="form-section">
            <h2>‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</h2>
            <div class="form-group">
                <label for="area">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡πÑ‡∏£‡πà):</label>
                <input type="number" id="area" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏£‡πà">
            </div>
            <div class="form-group">
                <label for="crop-type">‡∏õ‡∏•‡∏π‡∏Å‡∏û‡∏∑‡∏ä‡∏≠‡∏∞‡πÑ‡∏£:</label>
                <select id="crop-type">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä --</option>
                    <option value="‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏à‡πâ‡∏≤">‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏à‡πâ‡∏≤</option>
                    <option value="‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß">‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß</option>
                    <option value="‡∏°‡∏±‡∏ô‡∏™‡∏≥‡∏õ‡∏∞‡∏´‡∏•‡∏±‡∏á">‡∏°‡∏±‡∏ô‡∏™‡∏≥‡∏õ‡∏∞‡∏´‡∏•‡∏±‡∏á</option>
                    <option value="‡∏≠‡πâ‡∏≠‡∏¢">‡∏≠‡πâ‡∏≠‡∏¢</option>
                    <option value="‡∏°‡∏∞‡∏ô‡∏≤‡∏ß">‡∏°‡∏∞‡∏ô‡∏≤‡∏ß</option>
                    <option value="‡∏•‡∏≥‡πÑ‡∏¢">‡∏•‡∏≥‡πÑ‡∏¢</option>
                    <option value="‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á">‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á</option>
                    <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏û‡∏∑‡∏ä‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á)</option>
                </select>
            </div>
             <div class="form-group hidden" id="other-crop-group">
                <label for="other-crop-name">‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏∑‡∏ä:</label>
                <input type="text" id="other-crop-name" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô, ‡∏¢‡∏≤‡∏á‡∏û‡∏≤‡∏£‡∏≤">
            </div>
            <div class="form-group">
                <label for="yield">‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°):</label>
                <input type="number" id="yield" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡πÄ‡∏õ‡πá‡∏ô ‡∏Å‡∏Å.">
            </div>
            <div class="form-group">
                <label for="total-sales">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ö‡∏≤‡∏ó):</label>
                <input type="number" id="total-sales" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ">
            </div>
        </div>

        <div class="form-section">
            <h2>‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï (‡∏ö‡∏≤‡∏ó)</h2>
            
            <div class="form-group">
                <label for="seed-variety">‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏û‡∏∑‡∏ä:</label>
                <select id="seed-variety" class="hidden">
                    </select>
                <input type="text" id="other-variety-name" class="hidden" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå">
            </div>
            
            <div class="form-group">
                <label for="seed-cost">‡∏Ñ‡πà‡∏≤‡πÄ‡∏°‡∏•‡πá‡∏î‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå/‡∏ï‡πâ‡∏ô‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå:</label>
                <input type="number" id="seed-cost" placeholder="0">
            </div>
            <div class="form-group">
                <label for="fertilizer-cost">‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πã‡∏¢:</label>
                <input type="number" id="fertilizer-cost" placeholder="0">
            </div>
            <div class="form-group">
                <label for="chemical-cost">‡∏Ñ‡πà‡∏≤‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ/‡∏™‡∏≤‡∏£‡∏ä‡∏µ‡∏ß‡∏†‡∏±‡∏ì‡∏ë‡πå:</label>
                <input type="number" id="chemical-cost" placeholder="0">
            </div>
            <div class="form-group">
                <label for="labor-cost">‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô:</label>
                <input type="number" id="labor-cost" placeholder="0">
            </div>
            <div class="form-group">
                <label for="electricity-cost">‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ü‡πâ‡∏≤:</label>
                <input type="number" id="electricity-cost" placeholder="0">
            </div>
            <div class="form-group">
                <label for="water-cost">‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥:</label>
                <input type="number" id="water-cost" placeholder="0">
            </div>
            <div class="form-group">
                <label for="tool-rental-cost">‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠:</label>
                <input type="number" id="tool-rental-cost" placeholder="0">
            </div>
            <div class="form-group">
                <label for="land-rental-cost">‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô:</label>
                <input type="number" id="land-rental-cost" placeholder="0">
            </div>
            <div class="form-group">
                <label for="harvest-cost">‡∏Ñ‡πà‡∏≤‡∏£‡∏ñ‡πÑ‡∏ñ/‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß:</label>
                <input type="number" id="harvest-cost" placeholder="0">
            </div>
             <div class="form-group">
                <label for="loan-cost">‡∏Ñ‡πà‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ:</label>
                <input type="number" id="loan-cost" placeholder="0">
            </div>
            <div class="form-group">
                <label for="materials-cost">‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏≥‡πÄ‡∏Å‡∏©‡∏ï‡∏£:</label>
                <input type="number" id="materials-cost" placeholder="0">
            </div>
             <div class="form-group">
                <label for="equipment-cost">‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:</label>
                <input type="number" id="equipment-cost" placeholder="0">
            </div>
            <div class="form-group">
                <label for="other-costs">‡∏Ñ‡πà‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ:</label>
                <input type="number" id="other-costs" placeholder="0">
            </div>
            <hr>
            <h3>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
            <div id="total-cost">0.00 ‡∏ö‡∏≤‡∏ó</div>
        </div>

        <div class="form-section">
            <h2>‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô</h2>
            <h3>‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</h3>
            <div id="net-profit" class="loss">0.00 ‡∏ö‡∏≤‡∏ó</div>
        </div>
    </div>
    
    <div id="summary-output" class="summary-section">
        <h2>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h2>
        <div id="summary-table-container"></div>
        <div>
            <h3>‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</h3>
            <canvas id="cost-chart"></canvas>
        </div>
         <div>
            <h3>‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö, ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô, ‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡πÑ‡∏£</h3>
            <canvas id="profit-chart"></canvas>
        </div>
    </div>

    <div class="export-buttons">
        <button id="export-png">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (PNG)</button>
        <button id="export-pdf">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF</button>
    </div>

</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const cropVarieties = {
        '‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏à‡πâ‡∏≤': ['‡∏Å‡∏Ç85', '‡∏Å‡∏Ç43', '‡∏Å‡∏Ç61', '‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å 80', '‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ 1', '‡∏´‡∏≠‡∏°‡∏°‡∏∞‡∏•‡∏¥ 105', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏)'],
        '‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß': ['‡∏Å‡∏Ç6', '‡∏™‡∏±‡∏ô‡∏õ‡πà‡∏≤‡∏ï‡∏≠‡∏á 1', '‡∏Å‡∏Ç18', '‡∏´‡∏≠‡∏°‡∏ô‡∏≤‡∏Ñ‡∏≤', '‡∏ò‡∏±‡∏ç‡∏™‡∏¥‡∏£‡∏¥‡∏ô', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏)'],
        '‡∏°‡∏±‡∏ô‡∏™‡∏≥‡∏õ‡∏∞‡∏´‡∏•‡∏±‡∏á': ['‡∏£‡∏∞‡∏¢‡∏≠‡∏á 9', '‡∏£‡∏∞‡∏¢‡∏≠‡∏á 11', '‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå 50', '‡∏´‡πâ‡∏ß‡∏¢‡∏ö‡∏á 60', '‡∏û‡∏ß‡∏á‡πÄ‡∏û‡∏ä‡∏£', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏)'],
        '‡∏≠‡πâ‡∏≠‡∏¢': ['‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô 3', 'LK92-11', '‡∏≠‡∏π‡πà‡∏ó‡∏≠‡∏á 15', 'K88-92', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏)'],
        '‡∏°‡∏∞‡∏ô‡∏≤‡∏ß': ['‡πÅ‡∏õ‡πâ‡∏ô‡∏£‡∏≥‡πÑ‡∏û', '‡πÅ‡∏õ‡πâ‡∏ô‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£ 1', '‡πÅ‡∏õ‡πâ‡∏ô‡∏î‡∏Å‡∏û‡∏¥‡πÄ‡∏®‡∏©', '‡∏ï‡∏≤‡∏Æ‡∏¥‡∏ï‡∏¥', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏)'],
        '‡∏•‡∏≥‡πÑ‡∏¢': ['‡∏≠‡∏µ‡∏î‡∏≠', '‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π', '‡πÅ‡∏´‡πâ‡∏ß', '‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ß‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏)'],
        '‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á': ['‡∏ô‡πâ‡∏≥‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏™‡∏µ‡∏ó‡∏≠‡∏á', '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏™‡∏ß‡∏¢', '‡∏≠‡∏Å‡∏£‡πà‡∏≠‡∏á', '‡∏°‡∏´‡∏≤‡∏ä‡∏ô‡∏Å', 'R2E2', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏)']
    };

    const cropTypeSelect = document.getElementById('crop-type');
    const otherCropGroup = document.getElementById('other-crop-group');
    const seedVarietySelect = document.getElementById('seed-variety');
    const otherVarietyNameInput = document.getElementById('other-variety-name');
    
    // Chart instances
    let costChartInstance = null;
    let profitChartInstance = null;

    cropTypeSelect.addEventListener('change', function() {
        const selectedCrop = this.value;
        seedVarietySelect.innerHTML = '';
        otherVarietyNameInput.classList.add('hidden');
        otherCropGroup.classList.add('hidden');

        if (selectedCrop && cropVarieties[selectedCrop]) {
            seedVarietySelect.classList.remove('hidden');
            const varieties = cropVarieties[selectedCrop];
            varieties.forEach(variety => {
                const option = document.createElement('option');
                option.value = variety;
                option.textContent = variety;
                seedVarietySelect.appendChild(option);
            });
        } else if (selectedCrop === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') {
             otherCropGroup.classList.remove('hidden');
             seedVarietySelect.classList.add('hidden');
             otherVarietyNameInput.classList.remove('hidden');
             otherVarietyNameInput.placeholder = "‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏ô‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏û‡∏∑‡∏ä";
        } else {
            seedVarietySelect.classList.add('hidden');
        }
    });

    seedVarietySelect.addEventListener('change', function() {
        if (this.value === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏)') {
            otherVarietyNameInput.classList.remove('hidden');
            otherVarietyNameInput.placeholder = "‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå";
        } else {
            otherVarietyNameInput.classList.add('hidden');
        }
    });

    const inputs = document.querySelectorAll('input[type="number"]');
    inputs.forEach(input => {
        input.addEventListener('input', calculateAndDisplay);
    });

    function getCostData() {
        const costs = {
            "‡∏Ñ‡πà‡∏≤‡πÄ‡∏°‡∏•‡πá‡∏î‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå/‡∏ï‡πâ‡∏ô‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå": parseFloat(document.getElementById('seed-cost').value) || 0,
            "‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πã‡∏¢": parseFloat(document.getElementById('fertilizer-cost').value) || 0,
            "‡∏Ñ‡πà‡∏≤‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ/‡∏ä‡∏µ‡∏ß‡∏†‡∏±‡∏ì‡∏ë‡πå": parseFloat(document.getElementById('chemical-cost').value) || 0,
            "‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô": parseFloat(document.getElementById('labor-cost').value) || 0,
            "‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ü‡πâ‡∏≤": parseFloat(document.getElementById('electricity-cost').value) || 0,
            "‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥": parseFloat(document.getElementById('water-cost').value) || 0,
            "‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠": parseFloat(document.getElementById('tool-rental-cost').value) || 0,
            "‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô": parseFloat(document.getElementById('land-rental-cost').value) || 0,
            "‡∏Ñ‡πà‡∏≤‡∏£‡∏ñ‡πÑ‡∏ñ/‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß": parseFloat(document.getElementById('harvest-cost').value) || 0,
            "‡∏Ñ‡πà‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ": parseFloat(document.getElementById('loan-cost').value) || 0,
            "‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏≥‡πÄ‡∏Å‡∏©‡∏ï‡∏£": parseFloat(document.getElementById('materials-cost').value) || 0,
            "‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå": parseFloat(document.getElementById('equipment-cost').value) || 0,
            "‡∏Ñ‡πà‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ": parseFloat(document.getElementById('other-costs').value) || 0,
        };
        return costs;
    }
    
    function calculateAndDisplay() {
        const costs = getCostData();
        const totalCost = Object.values(costs).reduce((sum, cost) => sum + cost, 0);
        const totalSales = parseFloat(document.getElementById('total-sales').value) || 0;
        const netProfit = totalSales - totalCost;

        document.getElementById('total-cost').textContent = `${totalCost.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ‡∏ö‡∏≤‡∏ó`;
        const netProfitEl = document.getElementById('net-profit');
        netProfitEl.textContent = `${netProfit.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ‡∏ö‡∏≤‡∏ó`;

        if (netProfit >= 0) {
            netProfitEl.className = 'profit';
        } else {
            netProfitEl.className = 'loss';
        }
        
        updateSummary();
        updateCharts(costs, totalSales, totalCost, netProfit);
    }

    function updateSummary() {
        const summaryContainer = document.getElementById('summary-table-container');
        const costs = getCostData();
        const totalCost = Object.values(costs).reduce((sum, cost) => sum + cost, 0);
        const totalSales = parseFloat(document.getElementById('total-sales').value) || 0;
        const netProfit = totalSales - totalCost;

        let tableHTML = `
            <h3>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
            <table>
                <tr><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</th></tr>
                <tr><td><strong>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</strong></td><td><strong>${totalSales.toLocaleString('th-TH', { style: 'currency', currency: 'THB' })}</strong></td></tr>
                <tr><td colspan="2" style="background-color:#f7fafc;"><strong>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</strong></td></tr>`;
        
        for (const [key, value] of Object.entries(costs)) {
            if (value > 0) {
                tableHTML += `<tr><td>${key}</td><td>${value.toLocaleString('th-TH', { style: 'currency', currency: 'THB' })}</td></tr>`;
            }
        }

        tableHTML += `
                <tr><td><strong>‡∏£‡∏ß‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</strong></td><td><strong>${totalCost.toLocaleString('th-TH', { style: 'currency', currency: 'THB' })}</strong></td></tr>
                <tr><td><strong>‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</strong></td><td><strong>${netProfit.toLocaleString('th-TH', { style: 'currency', currency: 'THB' })}</strong></td></tr>
            </table>`;
        
        summaryContainer.innerHTML = tableHTML;
    }

    function updateCharts(costs, totalSales, totalCost, netProfit) {
        const costCtx = document.getElementById('cost-chart').getContext('2d');
        const profitCtx = document.getElementById('profit-chart').getContext('2d');

        const filteredCosts = Object.fromEntries(Object.entries(costs).filter(([_, v]) => v > 0));
        const costLabels = Object.keys(filteredCosts);
        const costData = Object.values(filteredCosts);

        if (costChartInstance) {
            costChartInstance.destroy();
        }
        costChartInstance = new Chart(costCtx, {
            type: 'pie',
            data: {
                labels: costLabels,
                datasets: [{
                    label: '‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô',
                    data: costData,
                    backgroundColor: [
                        '#4299E1', '#F56565', '#48BB78', '#ED8936', '#9F7AEA', '#ECC94B',
                        '#38B2AC', '#ED64A6', '#A0AEC0', '#F6E05E', '#718096', '#667EEA', '#B794F4'
                    ],
                }]
            },
            options: { responsive: true, plugins: { legend: { position: 'top' } } }
        });

        if (profitChartInstance) {
            profitChartInstance.destroy();
        }
        profitChartInstance = new Chart(profitCtx, {
            type: 'bar',
            data: {
                labels: ['‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö', '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°', '‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥'],
                datasets: [{
                    label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)',
                    data: [totalSales, totalCost, netProfit],
                    backgroundColor: ['#48BB78', '#F56565', netProfit >= 0 ? '#4299E1' : '#FC8181'],
                }]
            },
            options: { responsive: true, plugins: { legend: { display: false } } }
        });
    }

    document.getElementById('export-png').addEventListener('click', () => {
        html2canvas(document.getElementById('summary-output')).then(canvas => {
            const link = document.createElement('a');
            link.download = 'summary-costs.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    });

    document.getElementById('export-pdf').addEventListener('click', () => {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');
        const summaryElement = document.getElementById('summary-output');

        html2canvas(summaryElement, { scale: 2 }).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const imgProps = pdf.getImageProperties(imgData);
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
            pdf.save('summary-costs.pdf');
        });
    });
    
    // Initial calculation
    calculateAndDisplay();
});
</script>

</body>
</html>